<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title><%= APP_NAME %> - <%= title %></title>

    <style id="critical-ui-theme">
      :root {
        --bg: #060b14;
        --line: rgba(255, 255, 255, 0.1);
        --text: #e5ecff;
        --muted: #95a6c8;
        --shadow: 0 18px 34px rgba(0, 0, 0, 0.28);
        --radius: 16px;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--text);
        background:
          radial-gradient(1200px 600px at -10% -20%, rgba(76, 201, 240, 0.16), transparent 55%),
          radial-gradient(900px 450px at 110% -10%, rgba(255, 159, 67, 0.11), transparent 52%),
          linear-gradient(180deg, #050914 0%, #060b14 42%, #060d18 100%);
        font-family: "Segoe UI", "Inter", "Roboto", Arial, sans-serif;
      }
      a { color: inherit; text-decoration: none; }
      .app-shell {
        min-height: calc(100vh - 52px);
        display: grid;
        grid-template-columns: 280px minmax(0, 1fr);
        gap: 20px;
        padding: 18px;
      }
      .sidebar,
      .topbar,
      .card,
      .panel {
        border: 1px solid var(--line);
        border-radius: var(--radius);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
        box-shadow: var(--shadow);
      }
      .sidebar {
        position: sticky;
        top: 14px;
        align-self: start;
        padding: 18px 14px;
      }
      .sidebar-header { display: block; }
      .topbar {
        padding: 20px 18px;
        display: grid;
        grid-template-columns: minmax(0, 1fr) auto auto;
        align-items: center;
        gap: 14px;
        position: relative;
        min-height: 296px;
      }
      .topbar.topbar-kanban {
        min-height: 320px;
      }
      .topbar-left {
        min-width: 0;
      }
      .topbar-brand-slot {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }
      .topbar-brand-wrap {
        width: 262px;
        height: 262px;
        border-radius: 50%;
        padding: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border: 1px solid rgba(137, 220, 255, 0.55);
        box-shadow:
          0 16px 30px rgba(0, 0, 0, 0.35),
          0 0 0 6px rgba(74, 191, 255, 0.12);
        background:
          radial-gradient(circle at 30% 20%, rgba(93, 227, 255, 0.22), rgba(7, 19, 42, 0.5));
      }
      .topbar-brand-logo {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: contain;
        object-position: center;
        display: block;
        filter: brightness(1.16) contrast(1.18) saturate(1.14);
        transform: translateY(5px);
      }
      .page-title { margin: 0; font-size: 1.65rem; line-height: 1.8rem; }
      .page-content { margin-top: 14px; display: grid; gap: 12px; }
      .muted { color: var(--muted); }
      .grid { display: grid; gap: 12px; }
      .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .card, .panel { padding: 14px; }
      .card-title { font-weight: 760; font-size: 0.99rem; }
      .card-value { font-size: 2rem; font-weight: 880; margin-top: 8px; }
      .card-sub { margin-top: 8px; font-size: 0.78rem; }
      .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
      .btn {
        border: 1px solid rgba(76, 201, 240, 0.35);
        border-radius: 12px;
        background: linear-gradient(180deg, rgba(76, 201, 240, 0.28), rgba(76, 201, 240, 0.12));
        color: #edf7ff;
        padding: 9px 12px;
        font-weight: 700;
      }
      .footer { border-top: 1px solid var(--line); margin: 0 18px 12px 18px; }
      .footer-inner { display: flex; justify-content: space-between; gap: 8px; padding: 12px 6px; }
      .table { border: 1px solid var(--line); border-radius: 12px; overflow: auto; }
      .table table { width: 100%; border-collapse: collapse; min-width: 650px; }
      .table th, .table td {
        text-align: left;
        padding: 9px 11px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        font-size: 0.86rem;
      }
      .table th {
        color: var(--muted);
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      #leadsTable th.col-row_num,
      #leadsTable td.col-row_num {
        text-align: center !important;
        width: 56px;
        min-width: 56px;
        padding-left: 0;
        padding-right: 0;
      }
      @media (max-width: 1100px) {
        .app-shell { grid-template-columns: 1fr; padding: 12px; }
        .sidebar { position: static; }
      }
      @media (max-width: 720px) {
        .topbar {
          grid-template-columns: 1fr;
          justify-items: start;
        }
        .topbar-brand-slot {
          position: static;
          transform: none;
          left: auto;
          top: auto;
        }
        .topbar-brand-wrap {
          width: 158px;
          height: 158px;
        }
        .topbar-brand-slot {
          order: 3;
          width: 100%;
          justify-content: flex-start;
        }
        .grid-3, .grid-2 { grid-template-columns: 1fr; }
      }
    </style>

    <link
      rel="stylesheet"
      href="/public/css/styles.css?v=<%= ASSET_VERSION %>"
      onerror="this.onerror=null;this.href='/css/styles.css?v=<%= ASSET_VERSION %>';"
    />
  </head>
  <body>
    <div class="app-shell">
      <%- include("partials/nav") %>

      <main class="content">
        <header class="topbar <%= currentPath === '/kanban' ? 'topbar-kanban' : '' %>">
          <div class="topbar-left">
            <h1 class="page-title"><%= title %></h1>
            <p class="muted">
              API <span class="mono"><%= BACKEND_URL %></span>
            </p>
          </div>
          <div class="topbar-brand-slot">
            <div class="topbar-brand-wrap">
              <img
                class="topbar-brand-logo"
                src="/public/images/equipepulse_logo.png?v=<%= ASSET_VERSION %>"
                onerror="this.onerror=null;this.src='/public/images/equipepulse_circle.svg?v=<%= ASSET_VERSION %>';"
                alt="EquipePulse"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
          <div class="topbar-right">
            <span id="backendStatus" class="badge badge-warn">checando...</span>
            <a href="/health-ui" class="top-link">health-ui</a>
          </div>
        </header>

        <section class="page-content">
          <%- body %>
        </section>
      </main>
    </div>

    <footer class="footer">
      <div class="footer-inner">
        <span class="muted">Growth Equestre - UI Web</span>
        <span class="muted">Hackathon 2026</span>
      </div>
    </footer>

    <script>
      window.__GE__ = {
        paths: <%- JSON.stringify(paths) %>
      };
    </script>
    <script src="/public/js/app.js?v=<%= ASSET_VERSION %>"></script>
    <script>
      if (!window.__GE_APP_JS_LOADED__) {
        const script = document.createElement("script");
        script.src = "/js/app.js?v=<%= ASSET_VERSION %>";
        document.body.appendChild(script);
      }

      // If external stylesheet failed for any reason, inject CSS text at runtime.
      (function ensureFullTheme() {
        const sidebar = document.querySelector(".sidebar");
        if (!sidebar) return;
        const applied = window.getComputedStyle(sidebar).position === "sticky";
        if (applied) return;

        const inject = (cssText) => {
          if (!cssText || document.getElementById("runtime-theme")) return;
          const st = document.createElement("style");
          st.id = "runtime-theme";
          st.textContent = cssText;
          document.head.appendChild(st);
        };

        const v = "<%= ASSET_VERSION %>";
        fetch(`/public/css/styles.css?v=${v}`, { cache: "no-store" })
          .then((r) => (r.ok ? r.text() : Promise.reject(new Error("public css unavailable"))))
          .then(inject)
          .catch(() =>
            fetch(`/css/styles.css?v=${v}`, { cache: "no-store" })
              .then((r) => (r.ok ? r.text() : Promise.reject(new Error("css alias unavailable"))))
              .then(inject)
              .catch(() => {})
          );
      })();
    </script>
    <% if (typeof pageScript === "string") { %>
      <script src="<%= pageScript %>?v=<%= ASSET_VERSION %>"></script>
    <% } %>
  </body>
</html>
